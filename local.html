<!doctype html>
<html>
<head>
<meta charset="utf-8">

<title>exrunnable</title>

<link rel="stylesheet" href="css/exrunnable.css" type="text/css"/>

<script src="js/exrunnable.js"></script>
<script src="js/code.js"></script>

<script type="text/javascript">
window.onload = function () {
  var hankaku = [
    "char 0x41\n",
    "........\n",
    "...**...\n",
    "...**...\n",
    "...**...\n",
    "...**...\n",
    "..*..*..\n",
    "..*..*..\n",
    "..*..*..\n",
    "..*..*..\n",
    ".******.\n",
    ".*....*.\n",
    ".*....*.\n",
    ".*....*.\n",
    "***..***\n",
    "........\n",
    "........\n"];

  function rstrip(e) {
    var line = e.vars.line.substr(0, e.vars.line.length - 1);
    e.assign("line", line);
  }

  function makeStr(e) {
    var arr = [];
    var line = e.vars.line;

    for (var i = 0; i < line.length; i++) {
      arr.push(line[i]);
    }

    return "s   " + arr.join(" ");
  }

  var code = new exr.Code()
    .skip(2)
    .assign("f", "&lt;open file 'hankaku.c', mode 'w'&gt;")
    .skip(1)
    .print("#define X )*2+1\n")
    .print("#define _ )*2\n")
    .print("#define s ((((((((0\n")
    .print("\n")
    .print("char hankaku[4096] = {\n")
    .skip(1)
    .assign("i", 1)
    .foreach("line", hankaku)
      .a(rstrip)
      .skip(1)
      .aIf(function (e) { return e.vars.line.indexOf("char") === 0; })
        .print(function (e) { return "\n/* " + e.vars.line + " */\n"; })
      .elif(function (e) { return e.vars.line.length === 8; })
        .assign("line", function (e) { return e.vars.line.replace(/\./g, "_").replace(/\*/g, "X"); })
        .print(makeStr)
        .aIf(function (e) { return e.vars.i !== 4096; })
          .print("   ,\n")
        .aElse()
          .print("\n").endIf(true)
        .assign("i", function (e) { return e.vars.i + 1; }).endIf(true)
    .endForeach()
    .print("};\n")
    .print("\n")
    .print("#undef X\n")
    .print("#undef _\n")
    .print("#undef s\n")
    .skip(1)
    .assign("f", "&lt;closed file 'hankaku.c', mode 'w'&gt;");

  var env = {
    container: document.getElementById("container"),
    example: document.getElementById("example"),
    startLine: 2,
    maxVarsNum: 3,
    showRunButton: true,
    code: code
  };

  exr.create(env);
};
</script>

</head>

<body>

<div id="container">

<div class="code-container"><pre id="example"><span style="color: #888888">#!/usr/bin/env python</span>

f <span style="color: #333333">=</span> <span style="color: #007020">open</span>(<span style="background-color: #fff0f0">&#39;hankaku.c&#39;</span>, <span style="background-color: #fff0f0">&#39;w&#39;</span>)

f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;#define X )*2+1</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;#define _ )*2</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;#define s ((((((((0</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;char hankaku[4096] = {</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)

i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">for</span> line <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">open</span>(<span style="background-color: #fff0f0">&#39;hankaku.txt&#39;</span>, <span style="background-color: #fff0f0">&#39;r&#39;</span>):
    line <span style="color: #333333">=</span> line<span style="color: #333333">.</span>rstrip()

    <span style="color: #008800; font-weight: bold">if</span> line<span style="color: #333333">.</span>startswith(<span style="background-color: #fff0f0">&#39;char&#39;</span>):
        f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">/* &#39;</span> <span style="color: #333333">+</span> line <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; */</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
    <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #007020">len</span>(line) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">8</span>:
        line <span style="color: #333333">=</span> line<span style="color: #333333">.</span>replace(<span style="background-color: #fff0f0">&#39;.&#39;</span>, <span style="background-color: #fff0f0">&#39;_&#39;</span>)<span style="color: #333333">.</span>replace(<span style="background-color: #fff0f0">&#39;*&#39;</span>, <span style="background-color: #fff0f0">&#39;X&#39;</span>)
        f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;s   &#39;</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; &#39;</span><span style="color: #333333">.</span>join(line))
        <span style="color: #008800; font-weight: bold">if</span> i <span style="color: #333333">!=</span> <span style="color: #0000DD; font-weight: bold">4096</span>:
            f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;   ,</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
        <span style="color: #008800; font-weight: bold">else</span>:
            f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
        i <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>

f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;};</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;#undef X</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;#undef _</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)
f<span style="color: #333333">.</span>write(<span style="background-color: #fff0f0">&#39;#undef s</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&#39;</span>)

f<span style="color: #333333">.</span>close()</pre></div>

</div>

</body>

</html>
