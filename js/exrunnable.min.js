(function(){function d(c){if(c in f)var b=f[c];else b=new RegExp(["(?:^|\\s)",c,"(?!\\S)"].join("")),f[c]=b;return b}function e(c,b){var a=d(b);return c.className.match(a)?!0:!1}window.helpers={isNullOrUndef:function(c){return"undefined"===typeof c||null===c?!0:!1},createEvent:function(c,b){var a=["on",b,"Listeners"].join(""),g=["add",b,"Listener"].join(""),h=["remove",b,"Listener"].join("");c[a]=[];c[g]=function(b){-1===c[a].indexOf(b)&&c[a].push(b)};c[h]=function(b){b=c[a].indexOf(b);-1!==b&&c[a].splice(b,
1)};c["notify"+b]=function(){var b=arguments;c[a].forEach(function(a){a.apply(null,b)})}},hasClass:e,addClass:function(c,b){e(c,b)||(c.className=""===c.className?b:c.className+(" "+b))},removeClass:function(c,b){var a=d(b);c.className=c.className.replace(a,"")}};var f={}})();(function(){function d(a){if(helpers.hasClass(a.codeTable.rows[0].cells[0],"linenos"))for(var b=0;b<a.codeTable.rows.length;b++){var c=a.codeTable.rows[b];c.onclick=e(a,c,b)}}function e(a,b,c){return function(){a.breakpoints[c]?(helpers.removeClass(b,"breakpoint"),a.breakpoints[c]=!1):(helpers.addClass(b,"breakpoint"),a.breakpoints[c]=!0)}}function f(a){var b=Object.keys(a).map(function(b){return a[b]});b.sort(function(a,b){return(a.order||100)-(b.order||100)});return b}function c(a){a.setCurrentLine=
q;a.step=b;a.run=g;a.pause=h;a.reset=k;a.aCall=m;a.aReturn=l;a.print=n;a.createPanel=r}function b(){try{var b;a:{var c=this.code.funcs[this.curLine];if(c)for(var g=this.curFuncIndex;g<c.length;g++){var h=(0,c[g])(this);if(!helpers.isNullOrUndef(h)){b=h;break a}}b=void 0}var d=a(this,b,this.curLine),f=d.lineNo;a:{b=f;for(var e=d.funcIndex;;){var k=this.code.funcs[b];if(!k){d={lineNo:b,funcIndex:0};break a}c=null;for(g=e;g<k.length;g++){var m=k[g];if(!m.isSkip){d={lineNo:b,funcIndex:g};break a}c=m(this);
if(!helpers.isNullOrUndef(c))break}var n=a(this,c,b);b=n.lineNo;e=n.funcIndex}}f=d.lineNo;this.setCurrentLine(f);this.curFuncIndex=d.funcIndex;this.isRunning&&this.breakpoints[this.curLine]&&this.pause();this.isRunning&&this.curLine>=this.code.funcs.length&&this.notifyComplete(this)}catch(l){this.isRunning&&this.pause(),this.notifyError(l)}}function a(a,b,c){return helpers.isNullOrUndef(b)?{lineNo:c+1,funcIndex:0}:"number"===typeof b?{lineNo:Math.floor(b),funcIndex:0}:"string"===typeof b||b instanceof
String?a.code.labels[b]:{lineNo:b[0],funcIndex:b[1]}}function g(){if(!this.isRunning){var a=this;this.isRunning=!0;this.runTimerId=setInterval(function(){a.step()},1E3/this.runClock);this.notifyRun(this)}}function h(){this.isRunning&&(this.isRunning=!1,clearInterval(this.runTimerId),this.notifyPause(this))}function k(){this.code.reset();this.setCurrentLine(this.startLine);this.notifyReset(this);this.setup()}function m(a,b){this.frames.push({retAddr:a});this.notifyCall(this);if(b)for(var c in b)this.vars(c,
b[c])}function l(a){var b=this.frames.pop();this.ret=a;this.notifyReturn(this);return b.retAddr}function n(a,b){b&&(a+="\n");this.notifyPrint(this,a)}function q(a){var b=p(this,this.curLine);b&&helpers.removeClass(b,"selected");this.curLine=a;(b=p(this,this.curLine))&&helpers.addClass(b,"selected")}function p(a,b){return"undefined"===typeof b||0>b||b>=a.numLines?null:a.codeTable.rows[b]}function r(b){var a=document.createElement("div");a.className="exr-panel";var c=this.container;b?c.insertBefore(a,
c.firstChild):c.appendChild(a);return a}window.exr={createEnv:function(a,b,c){return{container:a,codeTable:b,code:c,startLine:0,setup:function(){},runClock:10,curLineColor:"#DDF",panels:{buttons:{order:1,init:exr.initButtons,isBefore:!0,showRunButton:!1},varsTable:{order:2,init:exr.initVarsTable},console:{order:3,init:exr.initConsole,cols:80,rows:8}}}},create:function(a){a.code.asert();c(a);t.forEach(function(b){helpers.createEvent(a,b)});a.isRunning=!1;a.frames=[];a.breakpoints=[];a.numLines=a.codeTable.rows.length;
a.vars=exr.createVars(a);d(a);f(a.panels).forEach(function(b){b.hide||b.init(a,b)});a.setup();a.setCurrentLine(a.startLine);a.curFuncIndex=0}};var t="Run Pause Reset Call Return Print Complete Error".split(" ")})();(function(){exr.createVars=function(d){function e(a,b){if(1===arguments.length)return f[a];if(2!==arguments.length)throw"number of args error";if(a in f)var h=!1;else h=!0,c.push(a);f[a]=b;var k=c.indexOf(a);e.notifyChangeVar(d,a,b,h,k);return e}var f={},c=[],b=[];helpers.createEvent(e,"ChangeVar");d.addResetListener(function(){f={};c=[];b=[]});e.foreach=function(a){c.forEach(function(b){a(b,f[b])})};e.save=function(){b.push({varsMap:f,varsList:c});f={};c=[]};e.restore=function(){var a=b.pop();f=
a.varsMap;c=a.varsList};d.addCallListener(e.save);d.addReturnListener(e.restore);return e}})();(function(){function d(c,b){var a=c.createPanel(b.isBefore);a.innerHTML="<input class='step-button' type='button' value='step' />"+(b.showRunButton?"<input class='run-button' type='button' value='run' />":"")+"<input class='reset-button' type='button' value='reset' />";a.getElementsByClassName("step-button")[0].onclick=function(){c.step()};b.showRunButton&&(c.runBtn=a.getElementsByClassName("run-button")[0],c.runBtn.onclick=function(){c.isRunning?c.pause():c.run()},c.onCompleteListeners.push(function(){c.pause()}));
a.getElementsByClassName("reset-button")[0].onclick=function(){c.reset()}}function e(c){c.runBtn.value="pause"}function f(c){c.runBtn.value="run"}exr.initButtons=function(c,b){d(c,b);b.showRunButton&&(c.addRunListener(e),c.addPauseListener(f))}})();(function(){function d(c){for(var b=c.varsTable.rows.length-1;0<b;b--)c.varsTable.deleteRow(b)}function e(c){d(c);c.vars.foreach(function(b,a){f(c,b,a,!0,-1)})}function f(c,b,a,g,h){g?(h=c.varsTable.rows.length-1,c=c.varsTable.insertRow(-1),c.className="exr-vars-"+h,c.insertCell(0),c.insertCell(1)):c=c.varsTable.getElementsByClassName("exr-vars-"+h)[0];c.childNodes[0].innerHTML=b;b=c.childNodes[1];if("string"===typeof a)a=['"',a,'"'].join("");else if("[object Array]"===Object.prototype.toString.call(a))a=
["[",a,"]"].join("");else if("object"===typeof a){h=["{"];c=!0;for(var d in a)c?c=!1:h.push(", "),h.push(d),h.push(": "),h.push(a[d]);h.push("}");a=h.join("")}else a=""+a;a=a.replace("\n","\\n");b.innerHTML=a}exr.initVarsTable=function(c,b){var a=c.createPanel(b.isBefore),g=document.createElement("table");g.className="exr-table";g.innerHTML="<tr><th>Name</th><th>Value</th></tr>";a.appendChild(g);c.varsTable=g;c.addResetListener(d);c.addCallListener(d);c.addReturnListener(e);c.vars.addChangeVarListener(f)}})();(function(){function d(d){d.consoleText="";d.console.innerHTML=""}function e(d,c){var b=d.consoleText,a=c;if("[object Array]"===Object.prototype.toString.call(a))a=["[",a,"]"].join("");else if("object"===typeof a){var g=["{"],h=!0,e;for(e in a)h?h=!1:g.push(", "),g.push(e),g.push(": "),g.push(a[e]);g.push("}");a=g.join("")}else a=""+a;d.consoleText=b+a;d.console.innerHTML=d.consoleText;d.console.scrollTop=d.console.scrollHeight}exr.initConsole=function(f,c){f.consoleText="";var b=f.createPanel();
b.innerHTML=["<textarea class='exr-console' readonly cols='",c.cols,"' rows='",c.rows,"'></textarea>"].join("");f.console=b.getElementsByClassName("exr-console")[0];f.addPrintListener(e);f.addResetListener(d)}})();(function(){function d(){this.funcs=[[]];this.forStack=[];this.whileStack=[];this.foreachStack=[];this.ifStack=[]}function e(){}function f(){}function c(b){return function(a,c){this.vars(a,function(d){return b(d.vars(a),c)});return this}}exr.Code=d;exr.cond=function(b,a,c){if("=="===a)return function(a){return a.vars(b)===c};if("!="===a)return function(a){return a.vars(b)!==c};if("<"===a)return function(a){return a.vars(b)<c};if("<="===a)return function(a){return a.vars(b)<=c};if(">"===a)return function(a){return a.vars(b)>
c};if(">="===a)return function(a){return a.vars(b)>=c};throw"unknown op: "+a;};e.isSkip=!0;d.prototype.asert=function(){if(0!==this.forStack.length)throw"forStack.length = "+this.forStack.length;if(0!==this.whileStack.length)throw"whileStack.length = "+this.whileStack.length;if(0!==this.foreachStack.length)throw"foreachStack.length = "+this.foreachStack.length;if(0!==this.ifStack.length)throw"ifStack.length = "+this.ifStack.length;};d.prototype.reset=function(){this.funcs.forEach(function(b){b.forEach(function(a){a.reset&&
a.reset()})})};d.prototype.getCurPos=function(){return[this.funcs.length-1,this.funcs[this.funcs.length-1].length-1]};d.prototype.getCurLineNo=function(){return this.funcs.length-1};d.prototype.getCurFuncIndex=function(){return this.funcs[this.funcs.length-1].length-1};d.prototype.a=function(b,a){1===arguments.length&&(a=this.getCurLineNo());var c=this.funcs[a];"undefined"===typeof c&&(c=[],this.funcs[a]=c);c.push(b);return this};d.prototype.nl=function(){this.funcs.push([]);return this};d.prototype.skip=
function(b){for(var a=0;a<b;a++)this.a(e).nl();return this};d.prototype.print=function(b,a){this.a(function(c){var d;d="function"===typeof b?b(c):b;c.print(d,a)});return this};d.prototype.println=function(b){this.print(b,!0);return this};d.prototype.printVar=function(b,a){this.print(function(a){return a.vars(b)},a);return this};d.prototype.printVarln=function(b){this.printVar(b,!0);return this};d.prototype.vars=function(b,a){this.a(function(c){"function"===typeof a?c.vars(b,a(c)):c.vars(b,a)});return this};
d.prototype.add=c(function(b,a){return b+a});d.prototype.sub=c(function(b,a){return b-a});d.prototype.mul=c(function(b,a){return b*a});d.prototype.div=c(function(b,a){return b/a});d.prototype.stop=function(){this.a(function(b){b.pause();return b.curLine});return this};d.prototype.jump=function(b){var a=function(){return b};a.isSkip=!0;this.a(a);return this};d.prototype.aCall=function(b,a){var c={};this.a(function(d){var e=a;"function"===typeof a&&(e=a(d));d.aCall(c.retAddr,e);return b});this.a(e);
c.retAddr=this.getCurPos();return this};d.prototype.implicitReturn=function(b){var a=function(a){var c;c="function"===typeof b?b(a):b;return a.aReturn(c)};a.isSkip=!0;this.a(a);return this};d.prototype.aReturn=function(b){this.a(function(a){var c;c="function"===typeof b?b(a):b;return a.aReturn(c)});return this};d.prototype.aFor=function(b){function a(){if(c>=b)return c=0,d.endI;c++}var c=0,d={};a.reset=function(){c=0};this.a(a);var e=this.getCurLineNo();this.forStack.push({i:e,obj:d});return this};
d.prototype.endFor=function(){var b=this.forStack.pop(),a=function(){return b.i};a.isSkip=!0;this.a(a);this.a(e);b.obj.endI=this.getCurPos();return this};d.prototype.breakFor=function(){var b=this.forStack[this.forStack.length-1];this.a(function(){b.reset();return b.obj.endI});return this};d.prototype.aWhile=function(b){var a={};this.a(function(c){if(!b(c))return a.endI});var c=this.getCurLineNo();this.whileStack.push({i:c,obj:a});return this};d.prototype.endWhile=function(){var b=this.whileStack.pop(),
a=function(){return b.i};a.isSkip=!0;this.a(a);this.a(e);b.obj.endI=this.getCurPos();return this};d.prototype.breakWhile=function(){var b=this.whileStack[this.whileStack.length-1];this.a(function(){return b.obj.endI});return this};d.prototype.foreach=function(b,a){function c(g){"function"===typeof a&&(f=a,a=a(g));if(d>=a.length)return d=0,a=f,e.endI;g.vars(b,a[d]);d++}var d=0,e={},f=a;c.reset=function(){d=0;a=f};this.a(c);var l=this.getCurLineNo();this.foreachStack.push({i:l,obj:e,reset:c.reset});
return this};d.prototype.endForeach=function(){var b=this.foreachStack.pop(),a=function(){return b.i};a.isSkip=!0;this.a(a);this.a(e);b.obj.endI=this.getCurPos();return this};d.prototype.breakForeach=function(){var b=this.foreachStack[this.foreachStack.length-1];this.a(function(){b.reset();return b.obj.endI});return this};d.prototype.aIf=function(b){var a={};this.a(function(c){if(!b(c))return a.elseI});this.ifStack.push({obj:a,chain:[]});return this};d.prototype.elif=function(b){var a=this.ifStack.pop(),
c={},d=a.chain.concat([c]);this.ifStack.push({obj:c,chain:d});d=this.getCurLineNo();a.obj.elseI=d;this.a(function(){return c.endI},d-1);this.a(function(a){if(!b(a))return c.elseI});return this};d.prototype.aElse=function(){var b=this.ifStack.pop(),a={},c=b.chain.concat([a]);this.ifStack.push({obj:a,chain:c});c=this.getCurLineNo();b.obj.elseI=c;this.a(function(){return a.endI},c-1);this.a(f);return this};d.prototype.endIf=function(){var b=this.ifStack.pop();this.a(e);var a=this.getCurPos();b.obj.elseI=
a;b.chain.forEach(function(b){b.endI=a});return this}})();
