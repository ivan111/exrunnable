(function(){function e(){var a,b=this.code.funcs,c=this.curLine;if(c<b.length){var d=b[c];d&&(a=d(this))}if("undefined"!==typeof a)(d=b[a])&&d.isEndLoop&&(a=d(this)),this.setCurrentLine(a);else{do d=b[++c];while(d===exr.SKIP);d&&d.isEndLoop&&(c=d(this));this.setCurrentLine(c);this.isRunning&&this.curLine>=this.code.funcs.length&&this.notifyComplete()}}function k(){if(!this.isRunning){var a=this;this.isRunning=!0;this.runTimerId=setInterval(function(){a.step()},1E3/this.runClock);this.runBtn&&(this.runBtn.value=
"pause")}}function q(){this.isRunning&&(this.isRunning=!1,clearInterval(this.runTimerId),this.runBtn&&(this.runBtn.value="run"))}function n(){this.code.reset();this.showConsole&&(this.consoleText=this.console.innerHTML="");this.setCurrentLine(this.startLine);this.vars={};this.varsList=[];if(this.showVarsTable)for(var a=0;a<this.maxVarsNum;a++){var b=this.varsTable.getElementsByClassName("exr-vars-"+a)[0];b.childNodes[0].innerHTML="\u3000";b.childNodes[1].innerHTML="\u3000"}this.setup()}function h(a,
b){a in this.vars?this.vars[a]=b:(this.varsList.push(a),this.vars[a]=b,this.notifyCreateVar(a,b));this.notifyChangeVar(a,b)}function b(a,b){this.showConsole&&(a=f(a,!0),b&&(a+="\n"),this.consoleText+=a,this.console.innerHTML=this.consoleText,this.console.scrollTop=this.console.scrollHeight)}function c(a,b,c){a.varsList.length<=a.maxVarsNum&&(a=a.varsTable.getElementsByClassName("exr-vars-"+(a.varsList.length-1))[0],a.childNodes[0].innerHTML=b,a.childNodes[1].innerHTML=f(c))}function d(a,b,c){if(b in
a.vars){var d;a:{d=a.varsList;for(var e=0;e<d.length;e++)if(d[e]===b){d=e;break a}d=-1}-1!==d&&d<=a.maxVarsNum&&(a=a.varsTable.getElementsByClassName("exr-vars-"+d)[0],a.childNodes[0].innerHTML=b,a.childNodes[1].innerHTML=f(c))}}function f(a,b){if("string"===typeof a)b||(a=['"',a,'"'].join(""));else if("[object Array]"===Object.prototype.toString.call(a))a=["[",a,"]"].join("");else if("object"===typeof a){var c=["{"],d=!0,e;for(e in a)d?d=!1:c.push(", "),c.push(e),c.push(": "),c.push(f(a[e],b));c.push("}");
a=c.join("")}else a=""+a;b||(a=a.replace("\n","\\n"));return a}function p(a){this.onChangeVarListeners.push(a)}function l(a,b){var c=this;this.onCreateVarListeners.forEach(function(d){d(c,a,b)})}function r(a,b){var c=this;this.onChangeVarListeners.forEach(function(d){d(c,a,b)})}function t(){var a=this;this.onCompleteListeners.forEach(function(b){b(a)})}function u(a){var b=this.example.getElementsByClassName("exr-line-"+this.curLine);1===b.length&&(b[0].style.backgroundColor="");this.curLine=a;b=this.example.getElementsByClassName("exr-line-"+
this.curLine);1===b.length&&(b[0].style.backgroundColor=this.curLineColor)}function v(a){var b=a.innerHTML.split("\n"),c;c="undefined"===typeof a.innerText?a.textContent.split("\n"):a.innerText.split("\n");var d=[];c.forEach(function(a,c){var e="";80>a.length&&(e=Array(80-a.length+1).join(" "));d.push(["<span class='exr-line-",c,"'>",b[c],e,"</span>"].join(""))});a.innerHTML=d.join("\n");return c.length}function w(a){var b=document.createElement("div");b.className="exr-panel";b.innerHTML="<input class='step-button' type='button' value='step' />"+
(a.showRunButton?"<input class='run-button' type='button' value='run' />":"")+"<input class='reset-button' type='button' value='reset' />";a.container.appendChild(b);a.container.insertBefore(b,a.container.firstChild);b.getElementsByClassName("step-button")[0].onclick=function(){a.step()};a.showRunButton&&(a.runBtn=b.getElementsByClassName("run-button")[0],a.runBtn.onclick=function(){a.isRunning?a.pause():a.run()},a.onCompleteListeners.push(function(){a.pause()}));b.getElementsByClassName("reset-button")[0].onclick=
function(){a.reset()}}window.exr={create:function(a){var f=x,g;for(g in f)g in a||(a[g]=f[g]);a.isRunning=!1;a.setCurrentLine=u;a.consoleText="";a.vars={};a.varsList=[];a.step=e;a.run=k;a.pause=q;a.reset=n;a.assign=h;a.print=b;a.onCreateVarListeners=[];a.onChangeVarListeners=[];a.onCompleteListeners=[];a.addChangeVarListener=p;a.notifyCreateVar=l;a.notifyChangeVar=r;a.notifyComplete=t;a.numLines=v(a.example);w(a);if(a.showVarsTable){f=[];f.push("<tr><th>Name</th><th>Value</th></tr>");for(g=0;g<a.maxVarsNum;g++)f.push("<tr class='exr-vars-"),
f.push(g),f.push("'><td>\u3000</td><td>\u3000</td></tr>");g=document.createElement("div");g.className="exr-panel";var m=document.createElement("table");m.className="exr-table";m.innerHTML=f.join("");g.appendChild(m);a.container.appendChild(g);a.varsTable=m;a.onCreateVarListeners.push(c);a.onChangeVarListeners.push(d)}a.showConsole&&(f=document.createElement("div"),f.className="exr-panel",f.innerHTML=["<textarea class='exr-console' readonly cols='",a.consoleCols,"' rows='",a.consoleRows,"'></textarea>"].join(""),
a.console=f.getElementsByClassName("exr-console")[0],a.container.appendChild(f));a.setup();a.setCurrentLine(a.startLine)}};var x={container:null,example:null,startLine:0,setup:function(){},code:null,maxVarsNum:5,showConsole:!0,consoleCols:80,consoleRows:8,showVarsTable:!0,showRunButton:!1,runClock:10,curLineColor:"#DDF"}})();(function(){function e(){this.funcs=[];this.forStack=[];this.whileStack=[];this.foreachStack=[];this.ifStack=[]}function k(){}function q(){}function n(){var b=arguments;return function(c){for(var d=0;d<b.length;d++){var f=b[d](c);if(f)return f}}}function h(b){return function(c,d){this.assign(c,function(f){return b(f.vars[c],d)});return this}}exr.Code=e;exr.SKIP=k;e.prototype.check=function(){return 0!==this.forStack.length?"forStack.length = "+this.forStack.length:0!==this.whileStack.length?"whileStack.length = "+
this.whileStack.length:0!==this.foreachStack.length?"foreachStack.length = "+this.foreachStack.length:0!==this.ifStack.length?"ifStack.length = "+this.ifStack.length:""};e.prototype.reset=function(){this.funcs.forEach(function(b){b.reset&&b.reset()})};e.prototype.getCurIndex=function(){return this.funcs.length-1};e.prototype.a=function(b){this.funcs.push(b);return this};e.prototype.skip=function(b){for(var c=0;c<b;c++)this.funcs.push(k);return this};e.prototype.print=function(b,c){this.funcs.push(function(d){var f;
f="function"===typeof b?b(d):b;d.print(f,c)});return this};e.prototype.println=function(b){this.print(b,!0);return this};e.prototype.printVar=function(b,c){this.print(function(c){return c.vars[b]},c);return this};e.prototype.printVarln=function(b){this.printVar(b,!0);return this};e.prototype.assign=function(b,c){this.funcs.push(function(d){"function"===typeof c?d.assign(b,c(d)):d.assign(b,c)});return this};e.prototype.add=h(function(b,c){return b+c});e.prototype.sub=h(function(b,c){return b-c});e.prototype.mul=
h(function(b,c){return b*c});e.prototype.div=h(function(b,c){return b/c});e.prototype.aFor=function(b){function c(){if(d>=b)return d=0,f.endI;d++}var d=0,f={};c.reset=function(){d=0};this.funcs.push(c);var e=this.getCurIndex();this.forStack.push({i:e,obj:f});return this};e.prototype.endFor=function(){var b=this.forStack.pop(),c=function(){return b.i};c.isEndLoop=!0;this.funcs.push(c);b.obj.endI=this.getCurIndex()+1;return this};e.prototype.breakFor=function(){var b=this.forStack[this.forStack.length-
1];this.funcs.push(function(){b.reset();return b.obj.endI});return this};e.prototype.aWhile=function(b){var c={};this.funcs.push(function(d){if(!b(d))return c.endI});var d=this.getCurIndex();this.whileStack.push({i:d,obj:c});return this};e.prototype.endWhile=function(){var b=this.whileStack.pop(),c=function(){return b.i};c.isEndLoop=!0;this.funcs.push(c);b.obj.endI=this.getCurIndex()+1;return this};e.prototype.breakWhile=function(){var b=this.whileStack[this.whileStack.length-1];this.funcs.push(function(){return b.obj.endI});
return this};e.prototype.foreach=function(b,c){function d(d){"function"===typeof c&&(l=c,c=c(d));if(e>=c.length)return e=0,c=l,p.endI;d.assign(b,c[e]);e++}var e=0,p={},l=c;d.reset=function(){e=0;c=l};this.funcs.push(d);var h=this.getCurIndex();this.foreachStack.push({i:h,obj:p,reset:d.reset});return this};e.prototype.endForeach=function(){var b=this.foreachStack.pop(),c=function(){return b.i};c.isEndLoop=!0;this.funcs.push(c);b.obj.endI=this.getCurIndex()+1;return this};e.prototype.breakForeach=function(){var b=
this.foreachStack[this.foreachStack.length-1];this.funcs.push(function(){b.reset();return b.obj.endI});return this};e.prototype.aIf=function(b){var c={};this.funcs.push(function(d){if(!b(d))return c.elseI});this.ifStack.push({type:"if",obj:c,chain:[]});return this};e.prototype.elif=function(b){var c={},d=this.ifStack.pop(),e=d.chain.concat([c]),h=this.getCurIndex();d.obj.elseI=h+1;this.funcs.push(function(d){if(!b(d))return c.elseI});this.ifStack.push({type:"elif",obj:c,chain:e});this.funcs[h]=n(this.funcs[h],
function(){return c.endI});return this};e.prototype.aElse=function(){var b=this.ifStack.pop(),c={},d=b.chain.concat([c]),e=this.getCurIndex();b.obj.elseI=e+1;this.funcs.push(q);this.ifStack.push({type:"else",obj:c,chain:d});this.funcs[e]=n(this.funcs[e],function(){return c.endI});return this};e.prototype.endIf=function(b){b||this.funcs.push(k);b=this.ifStack.pop();var c=this.getCurIndex();b.obj.elseI=c+1;b.chain.forEach(function(b){b.endI=c+1});return this}})();
