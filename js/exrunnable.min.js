(function(){function d(a,b){a in this.vars?(this.vars[a]=b,this.notifyChangeVar(a,b)):(this.varsList.push(a),this.vars[a]=b,this.notifyCreateVar(a,b))}function l(a,b){this.showConsole&&(a=f(a,!0),b&&(a+="\n"),this.consoleText+=a,this.console.innerHTML=this.consoleText,this.console.scrollTop=this.console.scrollHeight)}function n(a,b,c){a.varsList.length<=a.maxVarsNum&&(a=a.varsTable.getElementsByClassName("exr-vars-"+(a.varsList.length-1))[0],a.childNodes[0].innerHTML=b,a.childNodes[1].innerHTML=f(c))}
function m(a,b,c){if(b in a.vars){var e;a:{e=a.varsList;for(var d=0;d<e.length;d++)if(e[d]===b){e=d;break a}e=-1}-1!==e&&e<=a.maxVarsNum&&(a=a.varsTable.getElementsByClassName("exr-vars-"+e)[0],a.childNodes[0].innerHTML=b,a.childNodes[1].innerHTML=f(c))}}function f(a,b){if("string"===typeof a)b||(a=['"',a,'"'].join(""));else if("[object Array]"===Object.prototype.toString.call(a))a=["[",a,"]"].join("");else if("object"===typeof a){var c=["{"],e=!0,d;for(d in a)e?e=!1:c.push(", "),c.push(d),c.push(": "),
c.push(a[d]);c.push("}");a=c.join("")}else a=""+a;b||(a=a.replace("\n","\\n"));return a}function b(a,b){var c=this;this.onCreateVarListeners.forEach(function(e){e(c,a,b)})}function c(a,b){var c=this;this.onChangeVarListeners.forEach(function(e){e(c,a,b)})}function e(){var a=this;this.onCompleteListeners.forEach(function(b){b(a)})}function p(a){var b=this.example.getElementsByClassName("exr-line-"+this.curLine);1===b.length&&(b[0].style.backgroundColor="");this.curLine=a;b=this.example.getElementsByClassName("exr-line-"+
this.curLine);1===b.length&&(b[0].style.backgroundColor=this.curLineColor)}function k(a){var b=a.innerHTML.split("\n"),c;c="undefined"===typeof a.innerText?a.textContent.split("\n"):a.innerText.split("\n");var e=[];c.forEach(function(a,c){var d="";80>a.length&&(d=Array(80-a.length+1).join(" "));e.push(["<span class='exr-line-",c,"'>",b[c],d,"</span>"].join(""))});a.innerHTML=e.join("\n");return c.length}function q(a){var b=document.createElement("div");b.className="exr-panel";b.innerHTML="<input class='step-button' type='button' value='step' />"+
(a.showRunButton?"<input class='run-button' type='button' value='run' />":"")+"<input class='reset-button' type='button' value='reset' />";a.container.appendChild(b);a.container.insertBefore(b,a.container.firstChild);var c=function(){var b,c=a.code.funcs,e=a.curLine;if(e<c.length){var d=c[e];d&&(b=d(a))}if("undefined"!==typeof b)(d=c[b])&&d.isEndLoop&&(b=d(a)),a.setCurrentLine(b);else{do d=c[++e];while(d===exr.SKIP);d&&d.isEndLoop&&(e=d(a));a.setCurrentLine(e);a.isRunning&&a.curLine>=a.code.funcs.length&&
a.notifyComplete()}};b.getElementsByClassName("step-button")[0].onclick=c;if(a.showRunButton){var e=b.getElementsByClassName("run-button")[0];e.onclick=function(){a.isRunning?(a.isRunning=!1,clearInterval(a.runTimerId),this.value="run"):(a.isRunning=!0,a.runTimerId=setInterval(c,1E3/a.runClock),this.value="pause")};a.onCompleteListeners.push(function(){a.isRunning=!1;clearInterval(a.runTimerId);e.value="run"})}b.getElementsByClassName("reset-button")[0].onclick=function(){a.code.reset();a.showConsole&&
(a.console.innerHTML="",a.consoleText="");a.setCurrentLine(a.startLine);a.vars={};a.varsList=[];if(a.showVarsTable)for(var b=0;b<a.maxVarsNum;b++){var c=a.varsTable.getElementsByClassName("exr-vars-"+b)[0];c.childNodes[0].innerHTML="\u3000";c.childNodes[1].innerHTML="\u3000"}a.setup()}}window.exr={create:function(a){var g=r,h;for(h in g)h in a||(a[h]=g[h]);a.isRunning=!1;a.setCurrentLine=p;a.consoleText="";a.vars={};a.varsList=[];a.assign=d;a.print=l;a.onCreateVarListeners=[];a.onChangeVarListeners=
[];a.onCompleteListeners=[];a.notifyCreateVar=b;a.notifyChangeVar=c;a.notifyComplete=e;a.numLines=k(a.example);q(a);if(a.showVarsTable){g=[];g.push("<tr><th>Name</th><th>Value</th></tr>");for(h=0;h<a.maxVarsNum;h++)g.push("<tr class='exr-vars-"),g.push(h),g.push("'><td>\u3000</td><td>\u3000</td></tr>");h=document.createElement("div");h.className="exr-panel";var f=document.createElement("table");f.className="exr-table";f.innerHTML=g.join("");h.appendChild(f);a.container.appendChild(h);a.varsTable=
f;a.onCreateVarListeners.push(n);a.onChangeVarListeners.push(m)}a.showConsole&&(g=document.createElement("div"),g.className="exr-panel",g.innerHTML=["<textarea class='exr-console' readonly cols='",a.consoleCols,"' rows='",a.consoleRows,"'></textarea>"].join(""),a.console=g.getElementsByClassName("exr-console")[0],a.container.appendChild(g));a.setup();a.setCurrentLine(a.startLine)}};var r={container:null,example:null,startLine:0,setup:function(){},code:null,maxVarsNum:5,showConsole:!0,consoleCols:80,
consoleRows:8,showVarsTable:!0,showRunButton:!1,runClock:10,curLineColor:"#DDF"}})();(function(){function d(){this.funcs=[];this.forStack=[];this.whileStack=[];this.foreachStack=[];this.ifStack=[]}function l(){}function n(){}function m(){var b=arguments;return function(c){for(var e=0;e<b.length;e++){var d=b[e](c);if(d)return d}}}function f(b){return function(c,e){this.assign(c,function(d){return b(d.vars[c],e)});return this}}exr.Code=d;exr.SKIP=l;d.prototype.reset=function(){this.funcs.forEach(function(b){b.reset&&b.reset()})};d.prototype.getCurIndex=function(){return this.funcs.length-
1};d.prototype.a=function(b){this.funcs.push(b);return this};d.prototype.skip=function(b){for(var c=0;c<b;c++)this.funcs.push(l);return this};d.prototype.print=function(b,c){this.funcs.push(function(e){var d;d="function"===typeof b?b(e):b;e.print(d,c)});return this};d.prototype.println=function(b){this.print(b,!0);return this};d.prototype.printVar=function(b,c){this.print(function(c){return c.vars[b]},c);return this};d.prototype.printVarln=function(b){this.printVar(b,!0);return this};d.prototype.assign=
function(b,c){this.funcs.push(function(e){"function"===typeof c?e.assign(b,c(e)):e.assign(b,c)});return this};d.prototype.add=f(function(b,c){return b+c});d.prototype.sub=f(function(b,c){return b-c});d.prototype.mul=f(function(b,c){return b*c});d.prototype.div=f(function(b,c){return b/c});d.prototype.aFor=function(b){function c(){if(e>=b)return d.endI;e++}var e=0,d={};c.reset=function(){e=0};this.funcs.push(c);var f=this.getCurIndex();this.forStack.push({i:f,obj:d});return this};d.prototype.endFor=
function(){var b=this.forStack.pop(),c=function(){return b.i};c.isEndLoop=!0;this.funcs.push(c);b.obj.endI=this.getCurIndex()+1;return this};d.prototype.aWhile=function(b){var c={};this.funcs.push(function(d){if(!b(d))return c.endI});var d=this.getCurIndex();this.whileStack.push({i:d,obj:c});return this};d.prototype.endWhile=function(){var b=this.whileStack.pop(),c=function(){return b.i};c.isEndLoop=!0;this.funcs.push(c);b.obj.endI=this.getCurIndex()+1;return this};d.prototype.foreach=function(b,
c){function d(e){if(f>=c.length)return k.endI;e.assign(b,c[f]);f++}var f=0,k={};d.reset=function(){f=0};this.funcs.push(d);var l=this.getCurIndex();this.foreachStack.push({i:l,obj:k});return this};d.prototype.endForeach=function(){var b=this.foreachStack.pop(),c=function(){return b.i};c.isEndLoop=!0;this.funcs.push(c);b.obj.endI=this.getCurIndex()+1;return this};d.prototype.aIf=function(b){var c={};this.funcs.push(function(d){if(!b(d))return c.elseI});this.ifStack.push({type:"if",obj:c,chain:[]});
return this};d.prototype.elif=function(b){var c={},d=this.ifStack.pop(),f=d.chain.concat([c]),k=this.getCurIndex();d.obj.elseI=k+1;this.funcs.push(function(d){if(!b(d))return c.elseI});this.ifStack.push({type:"elif",obj:c,chain:f});this.funcs[k]=m(this.funcs[k],function(){return c.endI});return this};d.prototype.aElse=function(){var b=this.ifStack.pop(),c={},d=b.chain.concat([c]),f=this.getCurIndex();b.obj.elseI=f+1;this.funcs.push(n);this.ifStack.push({type:"else",obj:c,chain:d});this.funcs[f]=m(this.funcs[f],
function(){return c.endI});return this};d.prototype.endIf=function(b){b||this.funcs.push(l);b=this.ifStack.pop();var c=this.getCurIndex();b.obj.elseI=c+1;b.chain.forEach(function(b){b.endI=c+1});return this}})();
