(function(){function e(a,b){a in this.vars?(this.vars[a]=b,this.notifyChangeVar(a,b)):(this.varsList.push(a),this.vars[a]=b,this.notifyCreateVar(a,b))}function l(a,b,c){a.varsList.length<=a.maxVarsNum&&(a=a.varsTable.getElementsByClassName("exr-vars-"+(a.varsList.length-1))[0],a.childNodes[0].innerHTML=b,a.childNodes[1].innerHTML=f(c))}function m(a,b,c){if(b in a.vars){var d;a:{d=a.varsList;for(var e=0;e<d.length;e++)if(d[e]===b){d=e;break a}d=-1}-1!==d&&d<=a.maxVarsNum&&(a=a.varsTable.getElementsByClassName("exr-vars-"+
d)[0],a.childNodes[0].innerHTML=b,a.childNodes[1].innerHTML=f(c))}}function f(a){a="string"===typeof a?['"',a,'"'].join(""):""+a;return a.replace("\n","\\n")}function k(a,b){var c=this;this.onCreateVarListeners.forEach(function(d){d(c,a,b)})}function b(a,b){var c=this;this.onChangeVarListeners.forEach(function(d){d(c,a,b)})}function c(){var a=this;this.onCompleteListeners.forEach(function(b){b(a)})}function d(a){var b=this.example.getElementsByClassName("exr-line-"+this.curLine);1===b.length&&(b[0].style.backgroundColor=
"");this.curLine=a;b=this.example.getElementsByClassName("exr-line-"+this.curLine);1===b.length&&(b[0].style.backgroundColor=this.curLineColor)}function n(a){var b=a.innerHTML.split("\n"),c;c="undefined"===typeof a.innerText?a.textContent.split("\n"):a.innerText.split("\n");var d=[];c.forEach(function(a,c){var e="";80>a.length&&(e=Array(80-a.length+1).join(" "));d.push(["<span class='exr-line-",c,"'>",b[c],e,"</span>"].join(""))});a.innerHTML=d.join("\n");return c.length}function p(a){var b=document.createElement("div");
b.className="exr-panel";b.innerHTML="<input class='step-button' type='button' value='\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c' />"+(a.showRunButton?"<input class='run-button' type='button' value='\u5b9f\u884c' />":"")+"<input class='reset-button' type='button' value='\u30ea\u30bb\u30c3\u30c8' />";a.container.appendChild(b);a.container.insertBefore(b,a.container.firstChild);var c=function(){var b,c=a.code.funcs,d=a.curLine;if(d<c.length){var e=c[d];e&&(b=e(a))}if("undefined"!==typeof b)a.setCurrentLine(b);
else{do e=c[++d];while(e===exr.SKIP);a.setCurrentLine(d);a.isRunning&&a.curLine>=a.code.funcs.length&&a.notifyComplete()}};b.getElementsByClassName("step-button")[0].onclick=c;if(a.showRunButton){var d=b.getElementsByClassName("run-button")[0];d.onclick=function(){a.isRunning?(a.isRunning=!1,clearInterval(a.runTimerId),this.value="\u5b9f\u884c"):(a.isRunning=!0,a.runTimerId=setInterval(c,1E3/a.runClock),this.value="\u505c\u6b62")};a.onCompleteListeners.push(function(){a.isRunning=!1;clearInterval(a.runTimerId);
d.value="\u5b9f\u884c"})}b.getElementsByClassName("reset-button")[0].onclick=function(){a.code.reset();a.showConsole&&(a.console.innerHTML="",a.consoleText="");a.setCurrentLine(a.startLine);a.vars={};a.varsList=[];if(a.showVarsTable)for(var b=0;b<a.maxVarsNum;b++){var c=a.varsTable.getElementsByClassName("exr-vars-"+b)[0];c.childNodes[0].innerHTML="\u3000";c.childNodes[1].innerHTML="\u3000"}a.setup()}}window.exr={create:function(a){var g=q,h;for(h in g)h in a||(a[h]=g[h]);a.isRunning=!1;a.setCurrentLine=
d;a.consoleText="";a.vars={};a.varsList=[];a.assign=e;a.onCreateVarListeners=[];a.onChangeVarListeners=[];a.onCompleteListeners=[];a.notifyCreateVar=k;a.notifyChangeVar=b;a.notifyComplete=c;a.numLines=n(a.example);p(a);if(a.showVarsTable){g=[];g.push("<tr><th>\u5909\u6570\u540d</th><th>\u5024</th></tr>");for(h=0;h<a.maxVarsNum;h++)g.push("<tr class='exr-vars-"),g.push(h),g.push("'><td>\u3000</td><td>\u3000</td></tr>");h=document.createElement("div");h.className="exr-panel";var f=document.createElement("table");
f.className="exr-table";f.innerHTML=g.join("");h.appendChild(f);a.container.appendChild(h);a.varsTable=f;a.onCreateVarListeners.push(l);a.onChangeVarListeners.push(m)}a.showConsole&&(g=document.createElement("div"),g.className="exr-panel",g.innerHTML=["<textarea class='exr-console' readonly cols='",a.consoleCols,"' rows='",a.consoleRows,"'></textarea>"].join(""),a.console=g.getElementsByClassName("exr-console")[0],a.container.appendChild(g));a.setup();a.setCurrentLine(a.startLine)}};var q={container:null,
example:null,startLine:0,setup:function(){},code:null,maxVarsNum:5,showConsole:!0,consoleCols:80,consoleRows:8,showVarsTable:!0,showRunButton:!1,runClock:10,curLineColor:"#EEF"}})();(function(){function e(){this.funcs=[];this.forStack=[];this.whileStack=[];this.foreachStack=[];this.ifStack=[]}function l(){}function m(){}function f(){var b=arguments;return function(c){for(var d=0;d<b.length;d++){var e=b[d](c);if(e)return e}}}function k(b){return function(c,d){this.assign(c,function(e){return b(e.vars[c],d)});return this}}exr.Code=e;exr.SKIP=l;e.prototype.reset=function(){this.funcs.forEach(function(b){b.reset&&b.reset()})};e.prototype.getCurIndex=function(){return this.funcs.length-
1};e.prototype.a=function(b){this.funcs.push(b);return this};e.prototype.skip=function(b){for(var c=0;c<b;c++)this.funcs.push(l);return this};e.prototype.print=function(b){this.funcs.push(function(c){if(c.showConsole){var d;d="string"===typeof b?b:b(c);c.consoleText+=d;c.console.innerHTML=c.consoleText;c.console.scrollTop=c.console.scrollHeight}});return this};e.prototype.assign=function(b,c){this.funcs.push(function(d){"function"===typeof c?d.assign(b,c(d)):d.assign(b,c)});return this};e.prototype.add=
k(function(b,c){return b+c});e.prototype.sub=k(function(b,c){return b-c});e.prototype.mul=k(function(b,c){return b*c});e.prototype.div=k(function(b,c){return b/c});e.prototype.aFor=function(b){function c(){if(d>=b)return e.endI;d++}var d=0,e={};c.reset=function(){d=0};this.funcs.push(c);var f=this.getCurIndex();this.forStack.push({i:f,obj:e});return this};e.prototype.endFor=function(){var b=this.forStack.pop();this.funcs.push(function(){return b.i});b.obj.endI=this.getCurIndex()+1;return this};e.prototype.aWhile=
function(b){var c={};this.funcs.push(function(d){if(!b(d))return c.endI});var d=this.getCurIndex();this.whileStack.push({i:d,obj:c});return this};e.prototype.endWhile=function(){var b=this.whileStack.pop();this.funcs.push(function(){return b.i});b.obj.endI=this.getCurIndex()+1;return this};e.prototype.foreach=function(b,c){function d(a){if(e>=c.length)return f.endI;a.assign(b,c[e]);e++}var e=0,f={};d.reset=function(){e=0};this.funcs.push(d);var k=this.getCurIndex();this.foreachStack.push({i:k,obj:f});
return this};e.prototype.endForeach=function(){var b=this.foreachStack.pop();this.funcs.push(function(){return b.i});b.obj.endI=this.getCurIndex()+1;return this};e.prototype.aIf=function(b){var c={};this.funcs.push(function(d){if(!b(d))return c.elseI});this.ifStack.push({type:"if",obj:c,chain:[]});return this};e.prototype.elif=function(b){var c={},d=this.ifStack.pop(),e=d.chain.concat([c]),k=this.getCurIndex();d.obj.elseI=k+1;this.funcs.push(function(d){if(!b(d))return c.elseI});this.ifStack.push({type:"elif",
obj:c,chain:e});this.funcs[k]=f(this.funcs[k],function(){return c.endI});return this};e.prototype.aElse=function(){var b=this.ifStack.pop(),c={},d=b.chain.concat([c]),e=this.getCurIndex();b.obj.elseI=e+1;this.funcs.push(m);this.ifStack.push({type:"else",obj:c,chain:d});this.funcs[e]=f(this.funcs[e],function(){return c.endI});return this};e.prototype.endIf=function(b){b||this.funcs.push(l);b=this.ifStack.pop();var c=this.getCurIndex();b.obj.elseI=c+1;b.chain.forEach(function(b){b.endI=c+1});return this}})();
