(function(){function d(c){if(c in g)var a=g[c];else a=new RegExp(["(?:^|\\s)",c,"(?!\\S)"].join("")),g[c]=a;return a}function e(c,a){var b=d(a);return c.className.match(b)?!0:!1}window.helpers={isNullOrUndef:function(c){return"undefined"===typeof c||null===c?!0:!1},createEvent:function(c,a){var b=["on",a,"Listeners"].join(""),f=["add",a,"Listener"].join(""),h=["remove",a,"Listener"].join("");c[b]=[];c[f]=function(a){-1===c[b].indexOf(a)&&c[b].push(a)};c[h]=function(a){a=c[b].indexOf(a);-1!==a&&c[b].splice(a,
1)};c["notify"+a]=function(){var a=arguments;c[b].forEach(function(b){b.apply(null,a)})}},hasClass:e,addClass:function(c,a){e(c,a)||(c.className=""===c.className?a:c.className+(" "+a))},removeClass:function(c,a){var b=d(a);c.className=c.className.replace(b,"")}};var g={}})();(function(){function d(b){if(helpers.hasClass(b.codeTable.rows[0].cells[0],"linenos"))for(var a=0;a<b.codeTable.rows.length;a++){var c=b.codeTable.rows[a];c.onclick=e(b,c,a)}}function e(b,a,c){return function(){b.breakpoints[c]?(helpers.removeClass(a,"breakpoint"),b.breakpoints[c]=!1):(helpers.addClass(a,"breakpoint"),b.breakpoints[c]=!0)}}function g(b){var a=Object.keys(b).map(function(a){return b[a]});a.sort(function(b,a){return(b.order||100)-(a.order||100)});return a}function c(b){b.setCurrentLine=
q;b.step=a;b.run=f;b.pause=h;b.reset=k;b.aCall=m;b.aReturn=l;b.print=n;b.createPanel=r}function a(){try{var a;a:{var c=this.code.funcs[this.curLine];if(c)for(var f=this.curFuncIndex;f<c.length;f++){var h=(0,c[f])(this);if(!helpers.isNullOrUndef(h)){a=h;break a}}a=void 0}var d=b(this,a,this.curLine),g=d.lineNo;a:{a=g;for(var e=d.funcIndex;;){var k=this.code.funcs[a];if(!k){d={lineNo:a,funcIndex:0};break a}c=null;for(f=e;f<k.length;f++){var m=k[f];if(!m.isSkip){d={lineNo:a,funcIndex:f};break a}c=m(this);
if(!helpers.isNullOrUndef(c))break}var n=b(this,c,a);a=n.lineNo;e=n.funcIndex}}g=d.lineNo;this.setCurrentLine(g);this.curFuncIndex=d.funcIndex;this.isRunning&&this.breakpoints[this.curLine]&&this.pause();this.isRunning&&this.curLine>=this.code.funcs.length&&this.notifyComplete(this)}catch(l){this.isRunning&&this.pause(),this.notifyError(l)}}function b(b,a,c){return helpers.isNullOrUndef(a)?{lineNo:c+1,funcIndex:0}:"number"===typeof a?{lineNo:Math.floor(a),funcIndex:0}:"string"===typeof a||a instanceof
String?b.code.labels[a]:{lineNo:a[0],funcIndex:a[1]}}function f(){if(!this.isRunning){var a=this;this.isRunning=!0;this.runTimerId=setInterval(function(){a.step()},1E3/this.runClock);this.notifyRun(this)}}function h(){this.isRunning&&(this.isRunning=!1,clearInterval(this.runTimerId),this.notifyPause(this))}function k(){this.code.reset();this.setCurrentLine(this.startLine);this.notifyReset(this);this.setup()}function m(a,b){this.frames.push({retAddr:[this.curLine,this.curFuncIndex+1]});this.notifyCall(this,
a,this.curLine);var c=this.code.defs[a].params;if(c)for(var f=0;f<c.length;f++)this.vars(c[f],b[f])}function l(a){var b=this.frames.pop();this.ret=a;this.notifyReturn(this);return b.retAddr}function n(a,b){b&&(a+="\n");this.notifyPrint(this,a)}function q(a){var b=p(this,this.curLine);b&&helpers.removeClass(b,"selected");this.curLine=a;(b=p(this,this.curLine))&&helpers.addClass(b,"selected")}function p(a,b){return"undefined"===typeof b||0>b||b>=a.numLines?null:a.codeTable.rows[b]}function r(a){var b=
document.createElement("div");b.className="exr-panel";var c=this.container;a?c.insertBefore(b,c.firstChild):c.appendChild(b);return b}window.exr={createEnv:function(a,b,c){return{container:a,codeTable:b,code:c,startLine:0,setup:function(){},runClock:10,curLineColor:"#DDF",panels:{buttons:{order:1,init:exr.initButtons,isBefore:!0,showRunButton:!1},varsTable:{order:2,init:exr.initVarsTable},console:{order:3,init:exr.initConsole,cols:80,rows:8}}}},create:function(a){a.code.asert();c(a);t.forEach(function(b){helpers.createEvent(a,
b)});a.isRunning=!1;a.frames=[];a.breakpoints=[];a.numLines=a.codeTable.rows.length;a.vars=exr.createVars(a);d(a);g(a.panels).forEach(function(b){b.hide||b.init(a,b)});a.setup();a.setCurrentLine(a.startLine);a.curFuncIndex=0}};var t="Run Pause Reset Call Return Print Complete Error".split(" ")})();(function(){exr.createVars=function(d){function e(a,f){if(1===arguments.length)return g[a];if(2!==arguments.length)throw"number of args error";if(a in g)var h=!1;else h=!0,c.push(a);g[a]=f;var k=c.indexOf(a);e.notifyChangeVar(d,a,f,h,k);return e}var g={},c=[],a=[];helpers.createEvent(e,"ChangeVar");d.addResetListener(function(){g={};c=[];a=[]});e.foreach=function(a){c.forEach(function(c){a(c,g[c])})};e.save=function(){a.push({varsMap:g,varsList:c});g={};c=[]};e.restore=function(){var b=a.pop();g=
b.varsMap;c=b.varsList};d.addCallListener(e.save);d.addReturnListener(e.restore);return e}})();(function(){function d(c,a){var b=c.createPanel(a.isBefore);b.innerHTML="<input class='step-button' type='button' value='step' />"+(a.showRunButton?"<input class='run-button' type='button' value='run' />":"")+"<input class='reset-button' type='button' value='reset' />";b.getElementsByClassName("step-button")[0].onclick=function(){c.step()};a.showRunButton&&(c.runBtn=b.getElementsByClassName("run-button")[0],c.runBtn.onclick=function(){c.isRunning?c.pause():c.run()},c.onCompleteListeners.push(function(){c.pause()}));
b.getElementsByClassName("reset-button")[0].onclick=function(){c.reset()}}function e(c){c.runBtn.value="pause"}function g(c){c.runBtn.value="run"}exr.initButtons=function(c,a){d(c,a);a.showRunButton&&(c.addRunListener(e),c.addPauseListener(g))}})();(function(){function d(c){for(var a=c.varsTable.rows.length-1;0<a;a--)c.varsTable.deleteRow(a)}function e(c){d(c);c.vars.foreach(function(a,b){g(c,a,b,!0,-1)})}function g(c,a,b,f,h){f?(h=c.varsTable.rows.length-1,c=c.varsTable.insertRow(-1),c.className="exr-vars-"+h,c.insertCell(0),c.insertCell(1)):c=c.varsTable.getElementsByClassName("exr-vars-"+h)[0];c.childNodes[0].innerHTML=a;a=c.childNodes[1];if("string"===typeof b)b=['"',b,'"'].join("");else if("[object Array]"===Object.prototype.toString.call(b))b=
["[",b,"]"].join("");else if("object"===typeof b){h=["{"];c=!0;for(var d in b)c?c=!1:h.push(", "),h.push(d),h.push(": "),h.push(b[d]);h.push("}");b=h.join("")}else b=""+b;b=b.replace("\n","\\n");a.innerHTML=b}exr.initVarsTable=function(c,a){var b=c.createPanel(a.isBefore),f=document.createElement("table");f.className="exr-table";f.innerHTML="<tr><th>Name</th><th>Value</th></tr>";b.appendChild(f);c.varsTable=f;c.addResetListener(d);c.addCallListener(d);c.addReturnListener(e);c.vars.addChangeVarListener(g)}})();(function(){function d(d){d.consoleText="";d.console.innerHTML=""}function e(d,c){var a=d.consoleText,b=c;if("[object Array]"===Object.prototype.toString.call(b))b=["[",b,"]"].join("");else if("object"===typeof b){var f=["{"],h=!0,e;for(e in b)h?h=!1:f.push(", "),f.push(e),f.push(": "),f.push(b[e]);f.push("}");b=f.join("")}else b=""+b;d.consoleText=a+b;d.console.innerHTML=d.consoleText;d.console.scrollTop=d.console.scrollHeight}exr.initConsole=function(g,c){g.consoleText="";var a=g.createPanel();
a.innerHTML=["<textarea class='exr-console' readonly cols='",c.cols,"' rows='",c.rows,"'></textarea>"].join("");g.console=a.getElementsByClassName("exr-console")[0];g.addPrintListener(e);g.addResetListener(d)}})();(function(){function d(){this.funcs=[[]];this.defs={};this.defStack=[];this.forStack=[];this.whileStack=[];this.foreachStack=[];this.ifStack=[]}function e(){}function g(){}function c(a){return function(b,c){this.vars(b,function(d){return a(d.vars(b),c)});return this}}exr.Code=d;exr.cond=function(a,b,c){switch(b){case "==":return function(b){return b.vars(a)===c};case "!=":return function(b){return b.vars(a)!==c};case "<":return function(b){return b.vars(a)<c};case "<=":return function(b){return b.vars(a)<=
c};case ">":return function(b){return b.vars(a)>c};case ">=":return function(b){return b.vars(a)>=c}}throw"unknown op: "+b;};e.isSkip=!0;d.prototype.asert=function(){if(0!==this.defStack.length)throw"num(def) != num(endDef). defStack.length = "+this.defStack.length;if(0!==this.forStack.length)throw"num(for) != num(endFor). forStack.length = "+this.forStack.length;if(0!==this.whileStack.length)throw"num(while) != num(endWhile). whileStack.length = "+this.whileStack.length;if(0!==this.foreachStack.length)throw"num(foreach) != num(endForeach). foreachStack.length = "+
this.foreachStack.length;if(0!==this.ifStack.length)throw"num(if) != num(endIf). ifStack.length = "+this.ifStack.length;};d.prototype.reset=function(){this.funcs.forEach(function(a){a.forEach(function(a){a.reset&&a.reset()})})};d.prototype.getCurPos=function(){return[this.funcs.length-1,this.funcs[this.funcs.length-1].length-1]};d.prototype.getCurLineNo=function(){return this.funcs.length-1};d.prototype.getCurFuncIndex=function(){return this.funcs[this.funcs.length-1].length-1};d.prototype.a=function(a,
b){1===arguments.length&&(b=this.getCurLineNo());var c=this.funcs[b];"undefined"===typeof c&&(c=[],this.funcs[b]=c);c.push(a);return this};d.prototype.br=function(){this.funcs.push([]);return this};d.prototype.isSkip=function(){var a=this.getCurPos();this.funcs[a[0]][a[1]].isSkip=!0;return this};d.prototype.skip=function(a){for(var b=0;b<a;b++)this.br();return this};d.prototype.print=function(a,b){this.a(function(c){var d;d="function"===typeof a?a(c):a;c.print(d,b)});return this};d.prototype.printVar=
function(a,b){this.print(function(b){return b.vars(a)},b);return this};d.prototype.vars=function(a,b){this.a(function(c){"function"===typeof b?c.vars(a,b(c)):c.vars(a,b)});return this};d.prototype.add=c(function(a,b){return a+b});d.prototype.sub=c(function(a,b){return a-b});d.prototype.mul=c(function(a,b){return a*b});d.prototype.div=c(function(a,b){return a/b});d.prototype.stop=function(){this.a(function(a){a.pause();return a.curLine});return this};d.prototype.jump=function(a){var b=function(){return a};
b.isSkip=!0;this.a(b);return this};d.prototype.def=function(a,b){if(a in this.defs)throw"conflict function name: "+a;var c={};helpers.isNullOrUndef(b)&&(b=[]);var d=function(){return c.endI};d.isSkip=!0;this.a(d);this.a(e);this.defs[a]={pos:this.getCurPos(),params:b};this.defStack.push({obj:c});return this};d.prototype.endDef=function(){var a=this.defStack.pop();this.a(e);a.obj.endI=this.getCurPos();return this};d.prototype.aCall=function(a,b){var c=this;this.a(function(d){var e=b;"function"===typeof b&&
(e=b(d));d.aCall(a,e);return c.defs[a].pos});return this};d.prototype.aReturn=function(a){this.a(function(b){var c;c="function"===typeof a?a(b):a;return b.aReturn(c)});return this};d.prototype.aReturnVar=function(a){var b;b="string"===typeof a||a instanceof String?!0:!1;if(!b)throw"aReturnVar\u306e\u5f15\u6570\u306b\u306f\u5909\u6570\u540d\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044";this.a(function(b){var c=b.vars(a);return b.aReturn(c)});return this};d.prototype.aFor=function(a){function b(){if(c>=
a)return c=0,d.endI;c++}var c=0,d={};b.reset=function(){c=0};this.a(b);var e=this.getCurLineNo();this.forStack.push({i:e,obj:d});return this};d.prototype.endFor=function(){var a=this.forStack.pop(),b=function(){return a.i};b.isSkip=!0;this.a(b);this.a(e);a.obj.endI=this.getCurPos();return this};d.prototype.breakFor=function(){var a=this.forStack[this.forStack.length-1];this.a(function(){a.reset();return a.obj.endI});return this};d.prototype.aWhile=function(a){var b={};this.a(function(c){if(!a(c))return b.endI});
var c=this.getCurLineNo();this.whileStack.push({i:c,obj:b});return this};d.prototype.endWhile=function(){var a=this.whileStack.pop(),b=function(){return a.i};b.isSkip=!0;this.a(b);this.a(e);a.obj.endI=this.getCurPos();return this};d.prototype.breakWhile=function(){var a=this.whileStack[this.whileStack.length-1];this.a(function(){return a.obj.endI});return this};d.prototype.foreach=function(a,b){function c(f){"function"===typeof b&&(g=b,b=b(f));if(d>=b.length)return d=0,b=g,e.endI;f.vars(a,b[d]);d++}
var d=0,e={},g=b;c.reset=function(){d=0;b=g};this.a(c);var l=this.getCurLineNo();this.foreachStack.push({i:l,obj:e,reset:c.reset});return this};d.prototype.endForeach=function(){var a=this.foreachStack.pop(),b=function(){return a.i};b.isSkip=!0;this.a(b);this.a(e);a.obj.endI=this.getCurPos();return this};d.prototype.breakForeach=function(){var a=this.foreachStack[this.foreachStack.length-1];this.a(function(){a.reset();return a.obj.endI});return this};d.prototype.aIf=function(a){var b={};this.a(function(c){if(!a(c))return b.elseI});
this.ifStack.push({obj:b,chain:[]});return this};d.prototype.elif=function(a){var b=this.ifStack.pop(),c={},d=b.chain.concat([c]);this.ifStack.push({obj:c,chain:d});d=this.getCurLineNo();b.obj.elseI=d;this.a(function(){return c.endI},d-1);this.a(function(b){if(!a(b))return c.elseI});return this};d.prototype.aElse=function(){var a=this.ifStack.pop(),b={},c=a.chain.concat([b]);this.ifStack.push({obj:b,chain:c});c=this.getCurLineNo();a.obj.elseI=c;this.a(function(){return b.endI},c-1);this.a(g);return this};
d.prototype.endIf=function(){var a=this.ifStack.pop();this.a(e);var b=this.getCurPos();a.obj.elseI=b;a.chain.forEach(function(a){a.endI=b});return this}})();
